---
layout: post
title:  "Computer Network"
categories: network
tags: network
---

* content
{:toc}

# 概述

复习笔记，应付秋招。

## TCP & UDP

TCP(Transmission Control Protocol)和UDP(User Datagram Protocol)都属于传输层的协议，前者面向连接，而后者面向无连接，两者互为补充。

### TCP

**建立连接**

TCP的特点就在于它的可靠交付，面向连接意味着通信双方在传输数据前需要建立可靠连接。TCP的三次握手见下图(图源网络)：

![](/img/20180620002440131.gif)

为什么是三次握手？为了防止已经失效的请求报文再次传到服务器导致连接。如果使用两次握手，假设第一次客服端的请求报文在网络中堵塞住了，然后又发送了一个请求报文，结果第二次的请求报文先到达服务器并且建立了连接。若通信结束后，第一次发送的请求报文到达了服务器，导致又一次建立了连接。使用三次握手就不会出现这样的问题，因为服务器收到请求报文后还需要客户端的确认。

很久以前在网上看到一个比喻，TCP的三次握手相当于日常中的打电话，只有通过三次握手才能保证连接的可靠性。A打电话给B，首先要问“B听得到吗？”，询问A->B的连通性，这是第一次；然后B回应“我听得到，你听得到吗？”，确认A->B的连通性且询问B->A的联通性，这是第二次；最后A回应“听得到”，确认B->A的联通性，这是第三次，接着A就可以说话(传输数据)了。

**性能**

TCP有一系列机制来保证传输性能。

- 滑动窗口，一次传输多个数据；
- 拥塞控制，主要指拥塞窗口、慢启动、快重传和快恢复；

**断开连接**

TCP连接的断开需要四次挥手，主要是为了保证数据能够被完整传输。四次挥手见下图(图源网络)：

![](/img/20180620002506635.gif)

1. 当客服端**不再需要发送**数据时，给服务器发送释放请求；
2. 服务器接收请求发送回应，表示收到释放请求，但是服务器可能还有数据没有发送完，若有数据还会继续发送数据；
3. 服务发送完数据，然后在发送释放信号，表示数据发送完毕；
4. 客户端接收发送完毕的信号，作出回应并关闭连接，服务器收到回应也会关闭连接。

**长连接与短连接**

该概念通常现在HTTP的应用场景下，HTTP作为应用层协议，传输层协议使用的是TCP。短连接指的是服务器与客户端每进行一次HTTP操作就建立一个TCP连接，操作完成后就释放连接。长连接指的是服务器与客户端建立一个TCP连接后，可以一直使用该连接进行通信，直至有一方主动关闭连接。

长短连接的优劣很明显。由于TCP的建立与释放都需要一定的操作，对于短连接来说，频繁的建立/释放连接，肯定会影响应用的通信性能；而在用户与连接数过多的情况下，长连接可能会耗尽服务器的资源，同时连接的存活时间过长也会带来安全问题。

### UDP

如果把TCP比作打电话，那么UDP相当于发短信。UDP只保证尽力的交付，它只管发送，不管对方有没有收到甚至存不存在。当使用UDP作为传输层协议时，可靠性只能交给上层(应用层)协议来保证。
